apiVersion: kustomize.config.k8s.io/v1beta1 # Specifies the schema version for Kustomize
kind: Kustomization                        # Identifies this file as a Kustomize configuration

# Reference to shared base
resources:
  - ../../base                             # The path to your "golden" manifests (source of truth)

# GLOBAL TRANSFORMERS (Apply to all resources)

nameSuffix: -dev                           # Appends "-dev" to the end of every resource name
namePrefix: app1-                          # Prepends "app1-" to the beginning of every resource name
                                           # Result: nginx-deploy -> app1-nginx-deploy-dev

labels:
  - pairs:
      env: dev                             # Adds the label "env: dev" to all resources
    includeSelectors: true                 # CRITICAL: Also updates Deployment selectors and Service selectors 
                                           # so they continue to "match" the new labels.

images:
- name: nginx                              # Finds any container using the image "nginx"
  newName: nginx                           # (Optional) Can change the image registry/repo
  newTag: "latest"                         # Swaps the tag to "latest" (ideal for dev/testing)

commonAnnotations:
  branch: dev                              # Adds "branch: dev" to metadata.annotations (good for CI/CD tracking)
  support: 800-800                         # Adds another annotation; annotations don't affect logic, just metadata.

namespace: dev                             # Forces all resources to be deployed into the "dev" namespace.
                                           # Note: You must ensure this namespace exists in your cluster!

replicas:
- name: nginx-deploy                       # Targets the Deployment named "nginx-deploy" (from base)
  count: 2                                 # Overrides whatever replica count was set in the base file.